<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>2-Demo-Instructions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style id="mkstylesheet">
body{-webkit-font-smoothing:antialiased;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;margin:30px 0 0;padding:0;background:#fff}#wrapper{padding:20px}li{font-size:110%}li li{font-size:100%}li p{font-size:100%;margin:.5em 0}h1{color:#000}h2{color:#111}h3{color:#111;margin:0}h4{color:#111}h5{color:#111}h6{font-size:1em;line-height:1.5em;margin:1.5em 0}body,p,td,div{color:#111;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;word-wrap:break-word}a{color:#0d6ea1;text-decoration:none;-webkit-transition:color 0.2s ease-in-out;-moz-transition:color 0.2s ease-in-out;-o-transition:color 0.2s ease-in-out;-ms-transition:color 0.2s ease-in-out;transition:color 0.2s ease-in-out}a:hover{color:#3593d9}body{font-size:15px;line-height:21px;margin:0 auto}h1{font-size:37px;line-height:42px;margin-top:42px;margin-bottom:21px}h2{font-size:27px;line-height:42px;margin-top:42px;margin-bottom:21px}h3{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}h4{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}p,ul,ol,pre,table,blockquote{margin-top:21px;margin-bottom:21px}hr{border:1px solid;margin:-1px 0}ul ul,ol ol,ul ol,ol ul{margin-top:0;margin-bottom:0}b,strong,em,small,code{line-height:1}.footnote{color:#0d6ea1;font-size:.8em;vertical-align:super}abbr,acronym{border-bottom:1px dotted #aaa}#wrapper img{max-width:100%;height:auto}dd{font-size:1em;margin-bottom:1em}li>p:first-child{margin:0}ul ul,ul ol{margin-bottom:.4em}caption,col,colgroup,table,tbody,td,tfoot,th,thead,tr{border-spacing:0}table{border:1px solid rgba(0,0,0,0.25);border-collapse:collapse;display:table;empty-cells:hide;margin:-1px 0 1.3125em;padding:0;table-layout:fixed}caption{display:table-caption;font-weight:700}col{display:table-column}colgroup{display:table-column-group}tbody{display:table-row-group}tfoot{display:table-footer-group}thead{display:table-header-group}td,th{display:table-cell}tr{display:table-row}table th,table td{font-size:1.1em;line-height:1.3;padding:.5em 1em 0}table thead{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-bottom:1px solid rgba(0,0,0,0.2)}table tbody{background:rgba(0,0,0,0.05)}table tfoot{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-top:1px solid rgba(0,0,0,0.2)}figure{display:inline-block;overflow:hidden;position:relative;margin:1em 0 2em}figcaption{font-style:italic;text-align:center;background:white;color:#666}.poetry pre{display:block;font-family:Georgia,Garamond,serif !important;font-size:110% !important;font-style:italic;line-height:1.6em;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif !important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}blockquote p{font-size:110%;font-style:italic;line-height:1.6em}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;position:relative;vertical-align:super}sub{vertical-align:sub;top:-1px}p,h5{font-size:1.1429em;line-height:1.3125em;margin:1.3125em 0}dt,th{font-weight:700}table tr:nth-child(odd),table th:nth-child(odd),table td:nth-child(odd){background:rgba(255,255,255,0.06)}table tr:nth-child(even),table td:nth-child(even){background:rgba(200,200,200,0.25)}@media print{img,table,figure{page-break-inside:avoid}#wrapper{background:#fff;color:#303030;padding:10px;position:relative;text-indent:0}}@media screen{.inverted{background:#252a2a}.inverted #wrapper{background:#252a2a;color:#eee}.inverted hr{border-color:#333f40 !important}.inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dt,.inverted dd{color:#eee}.inverted pre{background:#ccc}.inverted pre code{color:#111}.inverted table{background:none}.inverted table tr:nth-child(odd),.inverted table td:nth-child(odd){background:none}.inverted a{color:#acd1d5}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7) !important;color:#eee !important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}}

@media print{
#generated-toc-clone,#generated-toc{display:none!important}
}
#generated-toc-clone li.missing,#mkreplaced-toc li.missing{list-style-type:none!important}#generated-toc-clone li, #mkreplaced-toc li{list-style-type:upper-roman}#generated-toc-clone li li, #mkreplaced-toc li li{list-style-type:decimal}#generated-toc-clone li li li,#mkreplaced-toc li li li{list-style-type:decimal-leading-zero}#generated-toc-clone li li li li,#mkreplaced-toc li li li li{list-style-type:lower-greek}#generated-toc-clone li li li li li,#mkreplaced-toc li li li li li{list-style-type:disc}#generated-toc-clone li li li li li li,#mkreplaced-toc li li li li li li{list-style-type:square}
</style>

</head>
<body class="normal firstload">
  <div id="wrapper">
      <h1 id="308:collectionviewcustomlayoutspart3:demoinstructions">308: Collection View Custom Layouts, Part 3: Demo Instructions</h1>

<p>In this demo, you’ll build a basic custom layout that displays the sessions of a conference schedule.</p>

<p>The steps here will be explained in the demo, but here are the raw steps in case you miss a step or get stuck.</p>

<h3 id="1createlayout">1) Create Layout</h3>

<p>Right-click on the <strong>Layouts</strong> group, and from the menu choose <strong>New File&#8230;</strong>. Then, select <strong>iOS\Source\Swift File</strong> and click <strong>Next</strong>. Name the file <strong>ScheduleLayout.swift</strong> and click <strong>Create</strong>. </p>

<p>Open the file <strong>ScheduleLayout.swift</strong>, and at the top import UIKit:</p>

<pre><code>import UIKit
</code></pre>

<p>Then add the class definition, making sure to subclass UICollectionViewLayout:</p>

<pre><code>class ScheduleLayout: UICollectionViewLayout {

}
</code></pre>

<h3 id="2updatestoryboard">2) Update Storyboard</h3>

<p>Open <strong>Main.storyboard</strong>. In the Document Inspector, expand <strong>Schedule Scene</strong> until you find the collection view. Select the collection view, and then in the Attributes Inspector change the <strong>Layout</strong> to <strong>Custom</strong> and set the <strong>Class</strong> to <strong>Schedule Layout</strong>.</p>

<h3 id="3adddatasource">3) Add Data Source</h3>

<p>Drag an <strong>Object</strong> from the Object Library onto the <strong>Schedule Scene</strong> in the Document Outline. Select the object, and in the Identity Inspector change its <strong>Custom Class</strong> to <strong>ScheduleDataSource</strong>.</p>

<p>In the Document Outline, right-click on the collection view to bring up its outlets. Click the small ‘x’ to disconnect the existing dataSource outlet, and then drag from the <strong>dataSource</strong> outlet to the <strong>ScheduleDataSource</strong> object to connect them.</p>

<h3 id="4setupproperties">4) Setup Properties</h3>

<p>Open <strong>ScheduleLayout.swift</strong> and add the following private property to the top of the class:</p>

<pre><code>private lazy var dataSource: ScheduleDataSource = {  
  return self.collectionView!.dataSource as ScheduleDataSource  
}()
</code></pre>

<p>And directly below that, add the following:</p>

<pre><code>private let widthPerHour: CGFloat = 180
</code></pre>

<h3 id="5calculateframe">5) Calculate Frame</h3>

<p>Add the <code>frameForSession(_:atIndexPath:)</code> method just below the property:</p>

<pre><code>private func frameForSession(session: Session, atIndexPath indexPath: NSIndexPath) -&gt; CGRect {  
  let heightPerTrack = collectionViewContentSize().height / CGFloat(dataSource.numberOfTracksInSchedule)  
  let width = widthPerHour * CGFloat(session.length)  
  let x = (CGFloat(session.hour) * widthPerHour) + (widthPerHour * CGFloat(session.offset))  
  let y = heightPerTrack * CGFloat(indexPath.item)  
  let frame = CGRect(x: x, y: y, width: width, height: heightPerTrack)  
  return frame  
}
</code></pre>

<h3 id="6determinecontentsize">6) Determine Content Size</h3>

<p>First, override <code>collectionViewContentSize()</code>. Place this just below <code>frameForSession(_: atIndexPath:)</code>:</p>

<pre><code>override func collectionViewContentSize() -&gt; CGSize {  
  let hoursInSchedule = CGFloat(dataSource.numberOfHoursInSchedule)  
  let height = CGRectGetHeight(collectionView!.bounds) - collectionView!.contentInset.top  
  let width = hoursInSchedule * widthPerHour  
  return CGSizeMake(width, height)  
}
</code></pre>

<h3 id="7calculatesessionframes">7) Calculate Session Frames</h3>

<p>Add the following <code>struct</code> below the properties:</p>

<pre><code>struct Frame {  
  var rect: CGRect  
  var indexPath: NSIndexPath  
}
</code></pre>

<p>This will be used to store the frame rect and index path of the individual items and supplementary views in the collection view.</p>

<p>Below that, add the following:</p>

<pre><code>var sessionFrames: [Frame] = []
</code></pre>

<p>This will act as a cache for the frames that we calculate in <code>prepareForLayout()</code>.</p>

<p>Finally, override <code>prepareForLayout()</code>, which is called the first time the collection view presents its content, and whenever the layout is invalidated. Add the following after <code>collectionViewContentSize()</code>:</p>

<pre><code>override func prepareLayout() {  
  super.prepareLayout()

  if sessionFrames.isEmpty {  
    for section in 0..&lt;collectionView!.numberOfSections() {  
      for item in 0..&lt;collectionView!.numberOfItemsInSection(section) {  
        let indexPath = NSIndexPath(forItem: item, inSection: section)  
        let rect = frameForSession(dataSource.sessionForIndexPath(indexPath), atIndexPath: indexPath)  
        let frame = Frame(rect: rect, indexPath: indexPath)  
        sessionFrames.append(frame)  
      }
    }  
  }
}
</code></pre>

<p>Here you’re simply calculating the frame and index path for every session in the schedule and caching them.</p>

<h3 id="8layoutattributesforelements">8) Layout Attributes For Elements</h3>

<p>Next, override <code>layoutAttributesForElementsInRect(_:)</code>. Add the following to <code>ScheduleLayout</code>:</p>

<pre><code>override func layoutAttributesForElementsInRect(rect: CGRect) -&gt; [AnyObject]? {  
  var layoutAttributes: [UICollectionViewLayoutAttributes] = []

    for frame in sessionFrames {  
      if CGRectIntersectsRect(frame.rect, rect) {  
        let attributes = UICollectionViewLayoutAttributes(forCellWithIndexPath: frame.indexPath)  
        attributes.frame = frame.rect  
        layoutAttributes.append(attributes)  
      }
    }  
  return layoutAttributes  
}
</code></pre>

<p>Here you determine which sessions are visible in the provided rect, and for those create the necessary layout attributes using the frame cache generated in <code>prepareForLayout()</code>.</p>

<p>Check out the accompanying slide for an overview of what this method is for, and why it’s so important.</p>

<p>Build and run.</p>

<h3 id="9addsessiontitles">9) Add Session Titles</h3>

<p>Open <strong>ScheduleViewController.swift</strong> and override <code>viewDidLoad()</code>, making sure to also call <code>super</code>. Add the following to the top of the class:</p>

<pre><code>override func viewDidLoad() {  
  super.viewDidLoad()

}
</code></pre>

<p>Then, add the following just below the call to <code>super</code>:</p>

<pre><code>let dataSource = collectionView!.dataSource as ScheduleDataSource
</code></pre>

<p>And finally, pass a cell configuration block to the data source that sets the cell’s <code>nameLabel</code> to the session title. Add the following to the bottom of <code>viewDidLoad()</code>:</p>

<pre><code>dataSource.cellConfigurationBlock = {(cell: ScheduleCell, indexPath: NSIndexPath, session: Session) in  
  cell.nameLabel.text = session.name  
}
</code></pre>

<p>Build and run.</p>

<p>And that’s it for the demo. It’s now time to move onto the lab, so if you could please open the Lab instructions and get started; you have 15 minutes.</p>
<!-- ##END MARKED WRAPPER## -->
    </div>
</body>
</html>